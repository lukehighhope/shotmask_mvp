# S1–S8 枪声检测准确度分析 (jeff 03-04)

评估条件：ref 来自 *cali.txt / *.txt，beep 来自 *beep.txt（2+ beep 时 t0=最后一个 beep），容差 ±0.04s。

---

## 1. 总体结果

| 模式 | 精确率 P | 召回率 R | F1 | 说明 |
|------|----------|----------|-----|------|
| **LogReg+CNN** | 72.9% | 91.1% | **81.0%** | 两阶段：候选 + LogReg 打分 |
| **CNN-only**   | 76.2% | 83.0% | **79.5%** | 仅 CNN 打分（与当前波形图管线一致） |

- **GT 总数**：122（CNN-only 匹配到的 ref 总数）/ 140（LogReg+CNN 下部分视频 GT 略多，因匹配方式不同）。
- **主要问题**：S7 在两种模式下都最差（F1 约 37%–64%）；S6 误报多、精确率偏低。

---

## 2. 分视频 (CNN-only)

| 视频 | GT | 检测数 n | TP | FP | FN | P | R | F1 |
|------|----|----------|----|----|----|---|---|-----|
| S1-main | 24 | 26 | 20 | 6 | 4 | 76.9% | 83.3% | 80.0% |
| S2-main | 22 | 22 | 18 | 4 | 4 | 81.8% | 81.8% | 81.8% |
| S3-main | 11 | 13 | 11 | 2 | 0 | 84.6% | **100%** | 91.7% |
| S4-main | 12 | 12 | 11 | 1 | 1 | 91.7% | 91.7% | 91.7% |
| S5-main | 12 | 13 | 12 | 1 | 0 | 92.3% | **100%** | **96.0%** |
| S6-main |  7 | 11 |  6 | 5 | 1 | 54.5% | 85.7% | 66.7% |
| **S7-main** | **14** | **13** | **5** | **8** | **9** | **38.5%** | **35.7%** | **37.0%** |
| S8-main | 10 | 12 | 10 | 2 | 0 | 83.3% | **100%** | 90.9% |
| **合计** | **122** | **122** | **93** | **29** | **19** | **76.2%** | **83.0%** | **79.5%** |

---

## 3. 简要结论

- **表现较好**：S3、S5、S8 召回 100%，F1 约 91%–96%；S4、S1、S2 也在 80%+。
- **S6**：召回尚可（85.7%），但 FP 多（5），精确率 54.5%，F1 约 67%；多为误报导致。
- **S7**：明显最差，P/R/F1 都低（约 38%/36%/37%），漏检多（FN=9）、误报也多（FP=8）。可能原因：
  - S7 有两个 beep（4.29s、8.5s），t0 取最后一个 8.5s；若 ref（S7.txt）与 beep/环境不一致，会导致整体对齐偏差。
  - 场景/音质与训练集差异大，CNN 在该段表现不稳。
- **改进方向**：优先核对 S7 的 ref/beep 与波形对齐；必要时对 S6 提高置信度阈值或后处理以减 FP。

---

## 4. 复现命令

```bash
# CNN-only（与当前波形图一致）
python evaluate_multivideo.py --folder "traning data/jeff 03-04" --cnn-only

# LogReg+CNN
python evaluate_multivideo.py --folder "traning data/jeff 03-04"
```
