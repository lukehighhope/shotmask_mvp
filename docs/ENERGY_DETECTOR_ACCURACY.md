# Energy 检测方式准确度分析

## 方法说明

- **流程**：先带通滤波(400–6000 Hz) → 取绝对值并短时平滑得能量包络 → 归一化到 [0,1] → **包络 > 0.3 的峰**记为一枪（峰间至少 0.08s）。
- **实现**：`detectors/shot_energy.py`，评估脚本 `evaluate_energy.py`。

## 评估结果（01032026 五段视频，tol=±0.04s）

| 视频   | GT | 检测数 n | TP | FP | FN | 精确率 P | 召回率 R | F1   |
|--------|----|----------|----|----|----|----------|----------|------|
| 1.mp4  | 29 | 37       | 19 | 18 | 10 | 51.4%    | 65.5%    | **57.6%** |
| 2.mp4  | 18 | 6        | 1  | 5  | 17 | 16.7%    | 5.6%     | 8.3%  |
| 3.mp4  | 30 | 36       | 4  | 32 | 26 | 11.1%    | 13.3%    | 12.1% |
| 4.mp4  | 30 | 38       | 7  | 31 | 23 | 18.4%    | 23.3%    | 20.6% |
| 5.mp4  | 29 | 42       | 5  | 37 | 24 | 11.9%    | 17.2%    | 14.1% |
| **合计** | **136** | **159** | **36** | **123** | **100** | **22.6%** | **26.5%** | **24.4%** |

## 分析

1. **整体**：F1≈**24.4%**，精确率 22.6%、召回率 26.5%。误报多(FP=123)、漏检多(FN=100)，仅靠“能量>0.3”无法区分枪声与其它瞬态声。
2. **1.mp4 尚可**：F1 **57.6%**，与当前 LogReg+CNN 在 1.mp4 上的 57.1% 接近；说明在该段上能量阈值与真值分布较匹配。
3. **2/3/4/5 明显变差**：F1 约 8%–21%。不同录音的响度、噪声、枪型差异大，**单一归一化 + 固定 0.3 阈值**泛化差：有的段整体能量偏低→漏检多，有的段噪声峰多→误报多。
4. **与 LogReg+CNN+FN 恢复 对比**（同数据集）：  
   - 改进后音频 pipeline：总 F1≈**36.7%**，R≈55.1%。  
   - Energy 方式：F1≈24.4%，R≈26.5%。  
   → 当前 energy 方法明显弱于“多特征+分类器+FN 恢复”。

## 结论与建议

- **为什么能量检测“不准”**：只看包络是否超过阈值，不区分枪声与拍门、击掌、说话爆破音、金属声等，所以要么漏检（阈值高）、要么误报很多（阈值低）。单靠能量无法兼顾高召回和高精确率。
- **优点**：实现简单、无训练、可解释（只看能量）；在 1.mp4 上可用作快速 baseline。
- **缺点**：跨视频泛化差，无法利用频谱形状等区分枪声与关门、金属声等。
- **建议**：  
  - 若只关心 1.mp4 或单一场景，可尝试调 threshold（如 0.25/0.35）或 per-video 归一化。  
  - **若需整体准确度，应以 LogReg+CNN 为主**（`main.py` / `evaluate_multivideo.py`），能量图仅作波形参考或辅助。
