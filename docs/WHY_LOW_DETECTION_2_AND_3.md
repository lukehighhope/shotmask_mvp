# 为什么 2 和 3 检测成功率低（beep 正常时）

## 结论概览

| 视频 | 主要原因 | 说明 |
|------|----------|------|
| **2.mp4** | **置信度阈值过滤** | 候选多但 CNN 置信度整体偏低，被 `min_confidence_threshold=0.5` 滤掉很多，最终只保留 8 个。 |
| **3.mp4** | **参考时间轴偏移 + 部分漏检** | 参考时间整体约 **0.3s 偏晚**（beep 或 3.txt 分段）；修正偏移后匹配可从 7 升到 13，其余未匹配多为漏检或 ref 误差。 |

Beep 文件与算法检测一致，时间轴也重叠，因此 **beep 标记本身不是主因**。

---

## 2.mp4：为什么只有 8 个检测？

- 日志：Stage1 候选 **62** → Stage2 最终 **8**；`min_conf=19`（被置信度阈值滤掉 19 个）。
- 配置里 `min_confidence_threshold: 0.5`，即置信度 &lt; 0.5 的枪声会被丢弃。
- **原因**：2 的声学条件（枪型、环境、距离、麦克风等）与训练集（如 1/4/5）差异较大，CNN 对 2 的 mel 片段给出的概率整体偏低，很多本应是枪声的候选落在 0.5 以下，被当成“不确定”滤掉 → **召回低**。

**可做**：
- 对 2 单独**降低阈值**（例如在 config 里为 2 用更低 `min_confidence_threshold`，或按视频自适应）；
- 或增加**类似 2 的录音**参与训练，减轻分布偏移。

---

## 3.mp4：为什么匹配少？

- 有 **20 个检测**、**30 个参考**，但当前只匹配上 **7** 个。
- 用脚本对参考时间做整体偏移扫描发现：**ref 整体提前 0.3s**（即 `ref_shift = -0.30s`）时，匹配数从 7 升到 **13**。
- 含义：当前参考时间轴（beep + 3.txt 的 cumsum）相对真实枪声约 **晚 0.3s**。可能来自：
  - beep 标得略晚，或  
  - 3.txt 里前几段间隔偏大/偏小，导致后续累积偏差。  
  即使你认为 beep 没问题，**3.txt 的分段误差**也可能造成这 0.3s 的整体偏移。
- 剩下 30−13=**17 个参考**仍对不上：可能是标注多计、漏检、或时间差超过 0.12s。

**可做**：
- 核对 3 的 **beep** 和 **3.txt 前几条间隔**是否与波形一致；
- 若确认是整体偏移，可在评估/可视化时对 3 的 ref 做 **−0.3s 偏移**再比；
- 或修正 3.txt/beep 后重新跑比较。

---

## 小结

- **2**：beep 没问题，主要是 **CNN 在 2 上置信度偏低 → 被 0.5 阈值滤掉**，属于模型/数据分布问题。
- **3**：beep 可能没问题，但 **参考时间轴整体约 0.3s 偏晚**（beep 或 3.txt），导致匹配数低；修正偏移后仍有不少未匹配，需结合 ref 质量和漏检一起看。
